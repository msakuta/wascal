<html>
    <head>
        <style type="text/css">
            body {
                color: #000000;
                text-align:center;

                background-color: #f0f0f0;
                margin: 0px;
                width: 100%;
            }
            .code {
                font-family:Monospace;
                font-size:15px;
            }
            .justify {
                text-align: justify;
                padding: 2em;
            }
        </style>
        <script>

const opts = {
    Math: {
        abs: x => Math.abs(x),
    },
    console: {
        log: console.log,
    },
    output: {
        putc: c => {
            const elem = document.getElementById("console");
            elem.innerHTML += String.fromCharCode(c);
        }
    }
}

let obj;
let argElems = [];

window.addEventListener("load", () => {
    const load = document.getElementById("load");
    load.addEventListener("click", async () => {
        console.log("Loading wasm");
        obj = await WebAssembly.instantiateStreaming(fetch("wascal.wasm"), opts);

        const params = document.getElementById("params");
        while (params.firstChild) params.removeChild(params.firstChild);
        argElems = [];

        if (!obj.instance.exports.hello) {
            const errorElem = document.createElement("div");
            errorElem.innerHTML = "Compiled Wasm module does not have function 'hello'";
            params.appendChild(errorElem);
            return;
        }

        for (let i = 0; i < obj.instance.exports.hello.length; i++) {
            const label = document.createElement("label");
            const input = document.createElement("input");
            input.setAttribute("type", "text");
            input.value = 1;
            label.appendChild(input);
            params.appendChild(label);
            argElems.push(input);
        }
    });
    const call = document.getElementById("call");
    call.addEventListener("click", async () => {
        console.log("Calling wasm");
        let args = [];
        for (let i = 0; i < obj.instance.exports.hello.length; i++) {
            const x = parseInt(argElems[i].value);
            args.push(x);
        }
        const output = document.getElementById('output');
        const hello = obj.instance.exports.hello;
        output.innerHTML = hello.apply(this, args);
    });
});

        </script>
    </head>
    <body>
        <h1>Wascal</h1>
        <button id="load">Load wasm module</button>
        <div id="params"></div>
        <p>
            Output: <span id="output"></span>
        </p>
        <button id="call">Call</button>
        <div class="code">
            <textarea  id="console" type="text" readonly cols="120"  rows="20" ></textarea>
        </div>
    </body>
</html>